# 実装タスクリスト

- [x] 1. プロジェクト初期化とDocker環境構築
  - Go modulesの初期化とプロジェクト構造の作成
  - docker-compose.ymlとDockerfileの作成
  - PostgreSQL + PostGISコンテナの設定
  - 環境変数ファイル(.env)の作成
  - _要件: 10.7_

- [x] 2. データベースマイグレーションの設定
  - golang-migrateのセットアップ
  - usersテーブルのマイグレーションファイル作成
  - pinsテーブルのマイグレーションファイル作成（PostGIS対応）
  - connectテーブルのマイグレーションファイル作成
  - マイグレーション実行スクリプトの作成
  - _要件: 10.1, 10.2, 10.3, 10.4, 10.5, 10.6_

- [X] 3. データモデルとリポジトリインターフェースの実装
  - [X] 3.1 データモデル構造体の定義
    - User, Pin, Connectモデルの作成（internal/model/）
    - リクエスト/レスポンス型の定義
    - _要件: 10.1, 10.2, 10.3_
  - [X] 3.2 リポジトリインターフェースの定義
    - UserRepository, PinRepository, ConnectRepositoryインターフェースの作成
    - _要件: 1.1, 6.1, 8.1_

- [X] 4. データベース接続とリポジトリ実装
  - [x] 4.1 データベース接続ユーティリティの実装
    - sqlxを使用したDB接続処理
    - 接続プール設定
    - _要件: 10.7_
  - [x] 4.2 UserRepositoryの実装
    - Create, FindByEmail, FindByID, Updateメソッドの実装
    - _要件: 1.1, 1.2, 2.1, 4.1_
  - [x] 4.3 PinRepositoryの実装
    - PostGISを使用したCRUD操作の実装
    - ST_MakePointとST_X/ST_Yの使用
    - _要件: 6.1, 6.2, 6.3, 7.1, 7.2_
  - [x] 4.4 ConnectRepositoryの実装
    - CRUD操作の実装
    - 外部キー制約の処理
    - _要件: 8.1, 8.2, 8.3, 9.1, 9.2_

- [x] 5. 認証ユーティリティの実装
  - [x] 5.1 JWTトークン生成と検証機能の実装
    - GenerateToken関数の実装
    - ValidateToken関数の実装
    - _要件: 2.2, 2.3_
  - [x] 5.2 パスワードハッシュ化機能の実装
    - bcryptを使用したHashPassword関数
    - CheckPassword関数の実装
    - _要件: 1.3_

- [x] 6. ミドルウェアの実装
  - [x] 6.1 認証ミドルウェアの実装
    - JWTトークン検証
    - コンテキストへのユーザーID設定
    - _要件: 4.3, 6.4, 7.4, 8.4, 9.4_
  - [x] 6.2 CORSミドルウェアの実装
    - Next.jsフロントエンドとの疎通設定
    - プリフライトリクエスト処理
    - _要件: なし（補足要件）_
  - [x] 6.3 ロギングミドルウェアの実装
    - リクエスト/レスポンスのログ出力
    - _要件: なし（補足要件）_

- [X] 7. サービス層の実装
  - [x] 7.1 AuthServiceの実装
    - SignUpメソッド（ユーザー登録）
    - Loginメソッド（ログイン処理）
    - ValidateTokenメソッド（トークン検証）
    - TestConnectionメソッド（DB接続テスト）
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 2.4, 5.1, 5.2, 5.3_
  - [x] 7.2 PinServiceの実装
    - CreatePinメソッド（Pin作成）
    - UpdatePinメソッド（Pin更新）
    - GetPinメソッド（Pin取得）
    - GetPinsByUserメソッド（ユーザーのPin一覧取得）
    - DeletePinメソッド（Pin削除）
    - _要件: 6.1, 6.2, 6.3, 6.4, 6.5, 7.1, 7.2, 7.3, 7.4, 7.5_
  - [x] 7.3 ConnectServiceの実装
    - CreateConnectメソッド（Connect作成）
    - UpdateConnectメソッド（Connect更新）
    - GetConnectsByUserメソッド（ユーザーのConnect一覧取得）
    - DeleteConnectメソッド（Connect削除）
    - Pin存在確認ロジック
    - _要件: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6_

- [X] 8. ハンドラー層の実装
  - [x] 8.1 共通レスポンスユーティリティの実装
    - JSON成功レスポンス関数
    - JSONエラーレスポンス関数
    - バリデーションエラー処理
    - _要件: 1.5, 2.4, 6.5, 7.5, 8.7, 9.6_
  - [x] 8.2 AuthHandlerの実装
    - POST /api/auth/signup（ユーザー登録）
    - POST /api/auth/login（ログイン）
    - POST /api/auth/logout（ログアウト）
    - GET /api/auth/me（ユーザー情報取得）
    - GET /api/auth/test（DB接続テスト）
    - _要件: 1.1, 1.4, 1.5, 2.1, 2.3, 2.4, 3.1, 3.2, 4.1, 4.2, 5.1, 5.2, 5.3_
  - [x] 8.3 PinHandlerの実装
    - POST /api/pins（Pin作成）
    - PUT /api/pins/:id（Pin更新）
    - GET /api/pins（Pin一覧取得）
    - GET /api/pins/:id（Pin取得）
    - DELETE /api/pins/:id（Pin削除）
    - _要件: 6.1, 6.5, 7.1, 7.5_
  - [x] 8.4 ConnectHandlerの実装
    - POST /api/connects（Connect作成）
    - PUT /api/connects/:id（Connect更新）
    - GET /api/connects（Connect一覧取得）
    - DELETE /api/connects/:id（Connect削除）
    - _要件: 8.1, 8.7, 9.1, 9.6_

- [x] 9. ルーティングとサーバー起動の実装
  - Chi routerのセットアップ
  - 全エンドポイントのルーティング設定
  - ミドルウェアの適用
  - サーバー起動処理（cmd/api/main.go）
  - グレースフルシャットダウンの実装
  - _要件: 全要件_

- [ ] 10. 統合テストの実装
  - [x] 10.1 テスト用データベースのセットアップ
    - dockertestを使用したテストDB起動
    - テストデータのセットアップとクリーンアップ
    - _要件: 全要件_
  - [ ] 10.2 認証エンドポイントの統合テスト
    - ユーザー登録、ログイン、ログアウトのテスト
    - エラーケースのテスト
    - _要件: 1.1, 1.4, 1.5, 2.1, 2.4, 3.1, 3.2, 4.1, 4.2_
  - [ ] 10.3 Pinエンドポイントの統合テスト
    - Pin作成、更新、取得、削除のテスト
    - 権限チェックのテスト
    - _要件: 6.1, 6.5, 7.1, 7.4, 7.5_
  - [ ] 10.4 Connectエンドポイントの統合テスト
    - Connect作成、更新、取得、削除のテスト
    - Pin存在確認のテスト
    - _要件: 8.1, 8.6, 8.7, 9.1, 9.5, 9.6_

- [ ] 11. ドキュメントとデプロイ準備
  - [ ] 11.1 README.mdの作成
    - プロジェクト概要
    - セットアップ手順
    - API仕様書
    - 開発環境の起動方法
    - _要件: なし（補足要件）_
  - [ ] 11.2 Fly.ioデプロイ設定
    - fly.tomlの作成
    - デプロイスクリプトの作成
    - 環境変数の設定手順
    - _要件: なし（補足要件）_
